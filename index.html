<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>注专转  驻专 - . 住</title>
    <!-- Chosen Palette: Premium Neutral Blue (with Dark Mode) -->
    <!-- Application Structure Plan: The application is a task-oriented SPA designed for a premium mobile-first experience, framed within a virtual iPhone. The core structure uses a fixed bottom navigation bar for switching between key modules: Home (Project Dashboard), Containers, Building Materials, and Reports. This modular approach was chosen for its intuitive and scalable nature. This final version adds a theme toggle for user preference. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Business activity -> Goal: Show trends -> Viz: Bar/Doughnut charts -> Interaction: Filters update charts.
        - Report Info: Order history -> Goal: Review/Re-order -> Viz: Interactive HTML table -> Interaction: Sort, search, re-order.
        - Report Info: Container status -> Goal: Highlight issues -> Viz: Dynamic "Cards" with conditional styling -> Interaction: Pulsing animation for overdue containers.
        - Report Info: User login -> Goal: Premium feel -> Viz: Glassmorphism, animations, pop-ups -> Interaction: Smooth transitions.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --background-start: #f0f2f5; --background-end: #e5e7eb; --text-primary: #1f2937; --text-secondary: #6b7280; --card-bg: #ffffff; --border-color: #e5e7eb; }
        html.dark { --background-start: #111827; --background-end: #1f2937; --text-primary: #f9fafb; --text-secondary: #9ca3af; --card-bg: #1f2937; --border-color: #374151; }
        body { font-family: 'Helvetica Neue', 'Arial', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .iphone-frame { width: 100vw; height: 100vh; max-width: 450px; max-height: 950px; margin: auto; border: 10px solid black; border-radius: 50px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); display: flex; flex-direction: column; overflow: hidden; position: relative; background-color: var(--background-start); }
        .iphone-screen { flex: 1; overflow-y: auto; position: relative; background: linear-gradient(to bottom, var(--background-start), var(--background-end)); color: var(--text-primary); }
        .iphone-notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 180px; height: 25px; background: black; border-bottom-left-radius: 15px; border-bottom-right-radius: 15px; z-index: 100; }
        .glassmorphism { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .nav-btn.active { color: #3b82f6; }
        .popup { transition: opacity 0.3s, transform 0.3s; }
        .popup.show { opacity: 1; transform: translateY(0); }
        .shine-effect { position: relative; overflow: hidden; }
        .shine-effect::after { content: ''; position: absolute; top: -50%; left: -50%; width: 20%; height: 200%; background: rgba(255, 255, 255, 0.3); transform: rotate(45deg); transition: all 0.5s ease-out; opacity: 0; }
        .shine-effect:hover::after { left: 120%; opacity: 1; }
        .chart-container { position: relative; width: 100%; height: 300px; max-height: 40vh; }
        .card { background-color: var(--card-bg); border: 1px solid var(--border-color); }
        .nav-bar { background-color: var(--card-bg); border-top: 1px solid var(--border-color); }
        .text-secondary { color: var(--text-secondary); }
    </style>
</head>
<body class="bg-gray-800 dark:bg-black flex items-center justify-center min-h-screen">

    <div class="iphone-frame">
        <div class="iphone-notch"></div>
        <div id="app-screen" class="iphone-screen">

            <!-- Login Page -->
            <div id="login-page" class="page active h-full bg-cover bg-center" style="background-image: url('https://placehold.co/450x950/003366/FFFFFF?text=Construction+Site+Video+Placeholder');">
                <div class="absolute inset-0 bg-blue-900/70"></div>
                <div class="relative h-full flex flex-col justify-center items-center p-8 text-white">
                    <div class="glassmorphism w-full max-w-sm rounded-3xl p-8 text-center space-y-6">
                        <img id="login-logo" src="https://placehold.co/150x50/FFFFFF/003366?text=H.SABAN+LOGO" alt="Company Logo" class="mx-auto h-12">
                        <img id="user-avatar" src="https://placehold.co/100x100/FFFFFF/CCCCCC?text=Avatar" alt="User Avatar" class="w-24 h-24 rounded-full mx-auto border-4 border-white/50">
                        <h1 class="text-2xl font-bold">住 注专转</h1>
                        <div>
                            <input id="phone-input" type="tel" placeholder="住驻专 驻" class="w-full bg-transparent border-b-2 border-white/50 text-center text-white placeholder-white/70 focus:outline-none focus:border-blue-400 py-2">
                        </div>
                        <div>
                            <input id="password-input" type="password" placeholder="住住" class="w-full bg-transparent border-b-2 border-white/50 text-center text-white placeholder-white/70 focus:outline-none focus:border-blue-400 py-2">
                        </div>
                        <button id="login-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-xl transition-transform transform hover:scale-105">住</button>
                    </div>
                </div>
            </div>

            <!-- Main App Content -->
            <div id="main-app" class="hidden h-full flex flex-col">
                <header class="p-4 flex justify-between items-center">
                    <h1 id="header-title" class="text-xl font-bold">驻专 驻专拽</h1>
                    <button id="theme-toggle-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                        <!-- Sun Icon -->
                        <svg class="w-6 h-6 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        <!-- Moon Icon -->
                        <svg class="w-6 h-6 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    </button>
                </header>

                <main class="flex-1 overflow-y-auto p-4 pt-0 pb-20">
                    <!-- Home Page -->
                    <div id="home-page" class="page">
                         <p class="text-secondary mb-6"> 转  转  转专 转 砖. 专 驻专拽  转  住祝 驻专拽 砖.</p>
                        <div id="projects-grid" class="grid grid-cols-1 gap-4">
                            <!-- Project cards will be injected here -->
                        </div>
                         <button id="add-project-fab" class="fixed bottom-24 right-6 bg-blue-500 text-white w-14 h-14 rounded-full shadow-lg text-3xl z-50 flex items-center justify-center">+</button>
                    </div>

                    <!-- Containers Page -->
                    <div id="containers-page" class="page">
                        <p class="text-secondary mb-6">爪驻 住住  转 砖  转. 注专转 转转专注 转 注 专转 转驻砖专  爪注 驻注转 专转  转专.</p>
                        <div id="containers-list" class="space-y-4">
                            <!-- Container cards will be injected here -->
                        </div>
                        <button id="add-container-fab" class="fixed bottom-24 right-6 bg-blue-500 text-white w-14 h-14 rounded-full shadow-lg text-3xl z-50 flex items-center justify-center">+</button>
                    </div>
                    
                    <!-- Building Materials Page -->
                    <div id="materials-page" class="page">
                        <p class="text-secondary mb-6"> 转 住专转 转 专 砖, 砖驻 转 拽转  爪专  砖 拽转.</p>
                        <button id="new-material-order-btn" class="w-full bg-green-500 text-white font-bold py-3 rounded-lg mb-6">转 专 砖</button>
                        <h2 class="text-xl font-semibold mb-2">住专转 转</h2>
                        <div class="card rounded-lg shadow overflow-hidden">
                           <table class="w-full text-sm">
                               <thead class="bg-gray-100 dark:bg-gray-800">
                                   <tr>
                                       <th class="p-3 text-right">转专</th>
                                       <th class="p-3 text-right">驻专拽</th>
                                       <th class="p-3 text-right">住住</th>
                                       <th class="p-3">驻注转</th>
                                   </tr>
                               </thead>
                               <tbody id="materials-history-body"></tbody>
                           </table>
                        </div>
                    </div>

                    <!-- Reports Page -->
                    <div id="reports-page" class="page">
                        <p class="text-secondary mb-6">拽 转转 注 驻注转 注住拽转 砖. 专驻 转 转注  转.</p>
                        <div class="space-y-8">
                            <div>
                                <h2 class="text-xl font-semibold mb-2">转 驻 砖</h2>
                                <div class="chart-container card p-4 rounded-lg shadow"><canvas id="monthlyOrdersChart"></canvas></div>
                            </div>
                            <div>
                                <h2 class="text-xl font-semibold mb-2">转驻转 住 转</h2>
                                <div class="chart-container card p-4 rounded-lg shadow"><canvas id="orderTypeChart"></canvas></div>
                            </div>
                             <div>
                               <h2 class="text-xl font-semibold mb-2">转 专</h2>
                               <div class="grid grid-cols-2 gap-4 text-center">
                                   <div class="card p-4 rounded-lg shadow shine-effect cursor-pointer">
                                       <div class="text-3xl font-bold text-blue-600">12</div><div class="text-secondary">转 驻注转</div>
                                   </div>
                                   <div class="card p-4 rounded-lg shadow shine-effect cursor-pointer">
                                       <div class="text-3xl font-bold text-red-500">3</div><div class="text-secondary">转 专</div>
                                   </div>
                                    <div class="card p-4 rounded-lg shadow shine-effect cursor-pointer">
                                       <div class="text-3xl font-bold text-green-600">45</div><div class="text-secondary">转 砖</div>
                                   </div>
                                    <div class="card p-4 rounded-lg shadow shine-effect cursor-pointer">
                                       <div class="text-3xl font-bold text-purple-600">7</div><div class="text-secondary">驻专拽 驻注</div>
                                   </div>
                               </div>
                            </div>
                        </div>
                    </div>
                </main>
                <!-- Bottom Navigation -->
                <nav class="absolute bottom-0 left-0 right-0 nav-bar flex justify-around text-secondary text-xs z-50 rounded-b-3xl">
                    <button data-page="home-page" class="nav-btn flex-1 flex flex-col items-center p-3 active">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>专砖</button>
                    <button data-page="containers-page" class="nav-btn flex-1 flex flex-col items-center p-3">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>转</button>
                    <button data-page="materials-page" class="nav-btn flex-1 flex flex-col items-center p-3">
                         <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path></svg>专 </button>
                    <button data-page="reports-page" class="nav-btn flex-1 flex flex-col items-center p-3">
                        <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>转</button>
                </nav>
            </div>
        </div>
        <div id="popup-container" class="absolute bottom-24 left-4 right-4 space-y-2 z-50"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyp9fB8y-2ZDp39MxfcysYlgOO6DlJKcndF202vRk0DLbWjIfgROc02GyCQJy21ORRCPQ/exec';
            const loginPage = document.getElementById('login-page');
            const mainApp = document.getElementById('main-app');
            const loginBtn = document.getElementById('login-btn');
            const pages = document.querySelectorAll('.page');
            const navBtns = document.querySelectorAll('.nav-btn');
            const popupContainer = document.getElementById('popup-container');
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            const headerTitle = document.getElementById('header-title');

            let monthlyOrdersChart, orderTypeChart;
            let currentUser = {};

            const mockData = {
                user: { name: '注专 ', lastLogin: '转, 17:30' },
                materialsHistory: [
                    { date: '28/08/25', project: '驻专拽 拽专', status: '砖' },
                    { date: '25/08/25', project: '驻专拽 专爪', status: '专' },
                    { date: '22/08/25', project: '驻专拽 拽专', status: '砖' },
                ],
                reports: {
                    monthlyOrders: { labels: ['', '', '', '住'], data: [25, 38, 52, 45] },
                    orderTypes: { labels: ['专 ', '转', '转'], data: [65, 25, 10] }
                }
            };
            
            function apiCall(action, params) {
                const formData = new FormData();
                formData.append('action', action);
                for (const key in params) {
                    formData.append(key, params[key]);
                }
                // Placeholder for loader
                return fetch(GAS_WEB_APP_URL, { method: 'POST', body: formData }).then(res => res.json());
            }

            function showPopup(message, duration = 3000) {
                const popup = document.createElement('div');
                popup.className = 'popup bg-gray-800 text-white text-center py-2 px-4 rounded-lg shadow-lg opacity-0 transform translate-y-4';
                popup.textContent = message;
                popupContainer.appendChild(popup);
                setTimeout(() => popup.classList.add('show'), 10);
                setTimeout(() => {
                    popup.classList.remove('show');
                    setTimeout(() => popup.remove(), 300);
                }, duration);
            }

            function handleLogin() {
                const phone = document.getElementById('phone-input').value;
                const password = document.getElementById('password-input').value;
                // Real login would use apiCall('login', { phone, password })
                currentUser = mockData.user; 
                loginPage.style.transition = 'opacity 0.5s';
                loginPage.style.opacity = '0';
                
                setTimeout(() => {
                    loginPage.classList.remove('active');
                    mainApp.classList.remove('hidden');
                    switchPage('home-page');
                    showPopup(`专 砖, ${currentUser.name}!`);
                    setTimeout(() => showPopup(`住 专 砖: ${currentUser.lastLogin}`), 1000);
                }, 500);
            }

            function switchPage(pageId) {
                pages.forEach(page => page.classList.toggle('active', page.id === pageId));
                navBtns.forEach(btn => btn.classList.toggle('active', btn.dataset.page === pageId));
                
                const pageTitles = {
                    'home-page': '驻专 驻专拽',
                    'containers-page': ' 驻拽 - 转',
                    'materials-page': '转 专 ',
                    'reports-page': '转 转'
                };
                headerTitle.textContent = pageTitles[pageId] || '. 住';

                if (pageId === 'reports-page') initCharts();
                if (pageId === 'materials-page') renderMaterialsHistory();
            }
            
            function renderMaterialsHistory() {
                const tbody = document.getElementById('materials-history-body');
                tbody.innerHTML = '';
                mockData.materialsHistory.forEach(order => {
                    const statusColor = order.status === '砖' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200';
                    const row = document.createElement('tr');
                    row.className = 'border-b border-border-color';
                    row.innerHTML = `<td class="p-3">${order.date}</td><td class="p-3">${order.project}</td><td class="p-3"><span class="px-2 py-1 text-xs rounded-full ${statusColor}">${order.status}</span></td><td class="p-3 text-center"><button class="text-blue-500"></button></td>`;
                    tbody.appendChild(row);
                });
            }

            function initCharts() {
                const isDarkMode = document.documentElement.classList.contains('dark');
                const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                const textColor = isDarkMode ? '#f9fafb' : '#1f2937';

                const chartOptions = {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: textColor } } },
                    scales: { x: { ticks: { color: textColor }, grid: { color: gridColor } }, y: { ticks: { color: textColor }, grid: { color: gridColor } } }
                };

                if(monthlyOrdersChart) monthlyOrdersChart.destroy();
                monthlyOrdersChart = new Chart(document.getElementById('monthlyOrdersChart').getContext('2d'), {
                    type: 'bar',
                    data: { labels: mockData.reports.monthlyOrders.labels, datasets: [{ label: '住驻专 转', data: mockData.reports.monthlyOrders.data, backgroundColor: 'rgba(59, 130, 246, 0.8)', borderColor: 'rgba(59, 130, 246, 1)', borderWidth: 1, borderRadius: 5 }] },
                    options: chartOptions
                });

                if(orderTypeChart) orderTypeChart.destroy();
                orderTypeChart = new Chart(document.getElementById('orderTypeChart').getContext('2d'), {
                    type: 'doughnut',
                    data: { labels: mockData.reports.orderTypes.labels, datasets: [{ data: mockData.reports.orderTypes.data, backgroundColor: ['#3b82f6', '#ef4444', '#8b5cf6'] }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: textColor } } } }
                });
            }

            function setupTheme() {
                if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                themeToggleBtn.addEventListener('click', () => {
                    document.documentElement.classList.toggle('dark');
                    localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
                    if (document.getElementById('reports-page').classList.contains('active')) {
                        initCharts(); // Re-render charts with new theme colors
                    }
                });
            }
            
            loginBtn.addEventListener('click', handleLogin);
            navBtns.forEach(btn => btn.addEventListener('click', () => switchPage(btn.dataset.page)));
            
            // Initial state
            setupTheme();
            switchPage('home-page'); // Start at home page
            document.getElementById('login-page').classList.add('active'); // but show login first
            mainApp.classList.add('hidden');
        });
    </script>
</body>
</html>
