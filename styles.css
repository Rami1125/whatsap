# Repo: hsaban-order-app (תוכן מוכן לפוש ל-GitHub)

הכנסתי כאן את כל הקבצים המופרדים שתצטרך לדחוף ל-GitHub: `index.html`, `styles.css`, `app.js`, `config.js`, `Code.gs`, קבצי CSV לדוגמה עבור Google Sheets, ו-`README.md` + הוראות פריסה מדויקות.

> הערה: אין לי יכולת לדחוף את הקבצים ישירות ל-GitHub בשם המשתמש שלך — אבל קיבלת כאן את כל התוכן המוכן. אפשר להעתיק/להדביק או להריץ את פקודות ה-git שציינתי ב-README כדי לבנות repo במהירות.

---

## מבנה הריפו המוצע

```
hsaban-order-app/
├─ README.md
├─ index.html
├─ styles.css
├─ app.js
├─ config.js
├─ Code.gs
├─ sheets/
│  ├─ clients.csv
│  ├─ products.csv
│  ├─ colors.csv
│  └─ orders_template.csv
└─ DEPLOY.md
```

---

## README.md (תמציתי)

```md
# H.Saban Order App - Demo

קבצי הדמו לאפליקציית הזמנות מבוססת HTML + Google Apps Script.

כולל:
- Front: index.html, styles.css, app.js
- Back: Code.gs (Apps Script) לתקשורת עם Google Sheets
- דוגמאות גיליונות: CSV תחת תיקיית `sheets/`

### מה לעשות במהירות
1. צור ריפו חדש ב-GitHub והעלה את הקבצים.
2. צור Google Spreadsheet חדש, העלה את ה-CSV מהתיקייה `sheets/` כגיליונות.
3. פתח Apps Script בפרויקט (Extensions > Apps Script) והדבק את `Code.gs`.
4. עדכן `SS_ID` ב-`Code.gs` וב-`config.js` ב-front עם כתובת ה-WebApp אחרי פריסה.
5. פרוס את ה-Web App והחלף `WEBAPP_URL` ב-`config.js`.

---
```

---

## index.html

```html
<!doctype html>
<html lang="he">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ח. סבן - הזמנות</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="brand">ח. סבן • הזמנות</div>
      <div class="login">
        <input id="username" placeholder="שם משתמש/טלפון" />
        <input id="password" placeholder="סיסמה" type="password" />
        <button id="btnLogin">כניסה</button>
      </div>
    </header>

    <main class="container">
      <aside class="sidebar">
        <section class="card">
          <h4>מוצרים</h4>
          <div id="productSuggestions"></div>
        </section>
        <section class="card">
          <h4>מניפת צבעים</h4>
          <div id="colorsList"></div>
        </section>
      </aside>

      <section class="content">
        <div id="welcomeArea" class="card">
          <h3 id="welcome">אנא היכנס/י</h3>
        </div>

        <div id="clientCard" class="card" style="display:none">
          <div id="clientName" class="title"></div>
          <div id="clientPhone" class="small"></div>
          <div id="quickActions" class="keywords"></div>
          <div class="actions"><button id="btnNewOrder">הזמנה חדשה</button><button id="btnHistory">היסטוריה</button></div>
        </div>

        <div id="orderForm" class="card" style="display:none">
          <div class="progress"><i></i></div>
          <h4>טופס הזמנה חדשה</h4>
          <div class="form-grid">
            <input id="contactName" placeholder="איש קשר" />
            <input id="contactPhone" placeholder="טלפון לקבלת סחורה" />
            <select id="actionType">
              <option>הצבה</option>
              <option>החלפה</option>
              <option>איסוף</option>
              <option>הובלה</option>
              <option>שאלה</option>
            </select>
            <select id="branch">
              <option value="התלמיד">התלמיד - התלמיד 6, הוד השרון</option>
              <option value="החרש">החרש - החרש 10, הוד השרון</option>
            </select>
          </div>
          <textarea id="supplyAddress" placeholder="כתובת אספקה / תיאור"></textarea>

          <div class="items">
            <input id="productSearch" placeholder="הזן מוצר/מק" />
            <div id="pickedItems" class="items-list"></div>
            <div class="btn-row"><button id="btnAddItem">הוסף פריט</button><button id="btnSendWA">שתף לוואטסאפ</button></div>
          </div>
        </div>

        <div id="historyArea" class="card" style="display:none"></div>
      </section>
    </main>

    <footer class="footer-nav">
      <button>ראשי</button>
      <button>מכולה</button>
      <button>הזמנת מנוף</button>
      <button>פריקה ידנית</button>
    </footer>
  </div>

  <script src="config.js"></script>
  <script src="app.js"></script>
</body>
</html>
```

---

## styles.css

```css
:root{--bg:#071022;--card:rgba(255,255,255,0.03);--accent:#0ea5a4}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071022,#0b1220);color:#e6eef8}
.app{max-width:1100px;margin:18px auto;padding:16px;background:var(--card);border-radius:12px;backdrop-filter:blur(8px)}
header{display:flex;align-items:center;justify-content:space-between}
.brand{font-weight:800}
.login input{margin-left:8px;padding:8px;border-radius:8px;border:0;background:rgba(255,255,255,0.02);color:inherit}
.container{display:flex;gap:12px;margin-top:12px}
.sidebar{width:320px}
.content{flex:1}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);padding:12px;border-radius:10px;margin-bottom:12px}
.title{font-weight:700}
.small{color:#9fb0c6}
.keywords{display:flex;gap:8px;flex-wrap:wrap}
.keyword{background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:999px;cursor:pointer}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
textarea{width:100%;min-height:60px;padding:8px;border-radius:8px;border:0;background:rgba(255,255,255,0.02)}
.items-list{max-height:200px;overflow:auto;margin-top:8px}
.btn-row{display:flex;gap:8px;margin-top:8px}
button{padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:#053;cursor:pointer}
.progress{height:8px;background:rgba(255,255,255,0.02);border-radius:99px;overflow:hidden}
.progress i{display:block;height:100%;width:40%;background:linear-gradient(90deg,var(--accent),#34d399);animation:load 1.2s ease-in-out}
@keyframes load{0%{transform:translateX(-20%)}100%{transform:translateX(0)}}
.footer-nav{display:flex;gap:8px;justify-content:space-around;padding-top:8px}
```

---

## config.js

```javascript
// החלף את הערכים האלו לאחר פריסת ה-WebApp
const WEBAPP_URL = 'REPLACE_WITH_YOUR_WEBAPP_URL';
const WHATSAPP_DEPT = '972508860896'; // מספר קבוע לח.סבן להודעות למחלקת הזמנות
```

---

## app.js

```javascript
// Front JS - תקשורת ל-Apps Script

let currentClient = null;
let pickedItems = [];

async function api(action, data){
  try{
    const body = JSON.stringify(data || {});
    const r = await fetch(WEBAPP_URL + '?action=' + action, {method:'POST',headers:{'Content-Type':'application/json'},body});
    return await r.json();
  } catch(e){console.error(e);alert('שגיאת תקשורת');}
}

// Login
document.getElementById('btnLogin').addEventListener('click', async ()=>{
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();
  if(!user||!pass){alert('אנא הזן שם משתמש וסיסמה');return}
  const res = await api('login',{user,pass});
  if(res && res.success){
    currentClient = res.client; onLogin();
  } else alert('כניסה נכשלה');
});

function onLogin(){
  document.getElementById('welcome').textContent = 'שלום, ' + currentClient.name;
  document.getElementById('clientCard').style.display='block';
}

// Load products/colors
(async ()=>{
  const p = await api('listProducts',{});
  const c = await api('listColors',{});
  if(p) renderList('productSuggestions', p.map(x=>`${x.name} | ${x.sku}`));
  if(c) renderList('colorsList', c.map(x=>`${x.brand} - ${x.code} - ${x.name}`));
})();

function renderList(id, arr){const el=document.getElementById(id);if(!el) return;el.innerHTML='';arr.forEach(v=>{const d=document.createElement('div');d.textContent=v;d.style.padding='6px';d.style.borderBottom='1px solid rgba(255,255,255,0.02)';d.onclick=()=>document.getElementById('productSearch').value=v;el.appendChild(d)})}

// Add item
document.getElementById('btnAddItem').addEventListener('click', async ()=>{
  const q = document.getElementById('productSearch').value.trim(); if(!q) return alert('הזן מוצר');
  const found = await api('searchProducts',{q});
  if(found && found.length){
    pickedItems.push({...found[0],qty:1});
  } else {
    pickedItems.push({name:q,unknown:true,qty:1});
  }
  renderPicked();
});

function renderPicked(){const el=document.getElementById('pickedItems');el.innerHTML='';pickedItems.forEach(it=>{const d=document.createElement('div');d.textContent=(it.unknown?it.name+" (לא מזוהה)":it.name+" | " + (it.sku||''));d.style.padding='6px';el.appendChild(d)})}

// Send WA
document.getElementById('btnSendWA').addEventListener('click', async ()=>{
  if(!currentClient) return alert('אנא היכנס');
  const payload = buildOrder();
  const created = await api('createOrder',{payload});
  if(!created || !created.success) return alert('שגיאה בשמירה');
  const waText = formatWA(created.order);
  const waUrl = `https://wa.me/${WHATSAPP_DEPT}?text=${encodeURIComponent(waText)}`;
  window.open(waUrl,'_blank');
  alert('נפתח וואטסאפ לשיתוף למחלקה');
});

function buildOrder(){
  return {
    clientId: currentClient.id,
    contactName: document.getElementById('contactName').value || currentClient.name,
    contactPhone: document.getElementById('contactPhone').value || currentClient.phone,
    actionType: document.getElementById('actionType').value,
    branch: document.getElementById('branch').value,
    address: document.getElementById('supplyAddress').value,
    items: pickedItems,
    createdAt: new Date().toISOString()
  }
}

function formatWA(order){
  const header = `שם לקוח: ${currentClient.name} | #${currentClient.id}\nאיש קשר: ${order.contactName} | ${order.contactPhone}\nסניף: ${order.branch} | סוג: ${order.actionType}\nכתובת: ${order.address}\n----\n`;
  const items = order.items.map(it=> it.unknown ? `*${it.name}* ⚠️ (מוצר לא זוהה)` : `${it.name} | מק"ט:${it.sku||''} | כמות:${it.qty||1}` ).join('\n');
  return header + items;
}
```

---

## Code.gs (מופרד, לשים בפרויקט Apps Script)

```javascript
const SS_ID = 'REPLACE_WITH_YOUR_SPREADSHEET_ID';

function doPost(e){
  try{
    const params = JSON.parse(e.postData.contents || '{}');
    const action = e.parameter.action || params.action;
    if(action=='login') return json(login(params.user, params.pass));
    if(action=='searchProducts') return json(searchProducts(params.q));
    if(action=='listProducts') return json(listProducts());
    if(action=='listColors') return json(listColors());
    if(action=='createOrder') return json(createOrder(params.payload));
    return json({success:false,err:'unknown action:'+action})
  }catch(err){return json({success:false,err:err.message})}
}

function json(obj){return ContentService.createTextOutput(JSON.stringify(obj)).setMimeType(ContentService.MimeType.JSON)}

function login(user,pass){
  const ss = SpreadsheetApp.openById(SS_ID);
  const sh = ss.getSheetByName('clients');
  if(!sh) return {success:false};
  const rows = sh.getDataRange().getValues();
  const headers = rows.shift();
  for(const r of rows){
    const rec = rowToObj(headers,r);
    if((rec.phone==user || rec.username==user) && rec.password==pass){
      return {success:true,client:{id:rec.clientId,name:rec.name,phone:rec.phone,email:rec.email}};
    }
  }
  return {success:false};
}

function rowToObj(headers,row){const o={};headers.forEach((h,i)=>o[h]=row[i]);return o}

function listProducts(){const ss=SpreadsheetApp.openById(SS_ID);const sh=ss.getSheetByName('products');if(!sh) return [];const rows=sh.getDataRange().getValues();const headers=rows.shift();return rows.map(r=>rowToObj(headers,r))}

function listColors(){const ss=SpreadsheetApp.openById(SS_ID);const sh=ss.getSheetByName('colors');if(!sh) return [];const rows=sh.getDataRange().getValues();const headers=rows.shift();return rows.map(r=>rowToObj(headers,r))}

function searchProducts(q){if(!q) return [];const all=listProducts();const Q=q.toString().toLowerCase();return all.filter(p=> (p.name||'').toString().toLowerCase().includes(Q) || (p.sku||'').toString().toLowerCase().includes(Q)).slice(0,20)}

function createOrder(payload){
  const ss=SpreadsheetApp.openById(SS_ID);
  let sh=ss.getSheetByName('orders');
  const headers=['orderId','clientId','clientName','contactName','contactPhone','actionType','branch','address','items','status','createdAt','sentToWhatsapp','printed','lastUpdater'];
  if(!sh) sh = ss.insertSheet('orders');
  if(sh.getLastRow()==0) sh.appendRow(headers);
  const orderId = 'ORD-'+Utilities.getUuid().slice(0,8).toUpperCase();
  const itemsStr = JSON.stringify(payload.items || []);
  const row=[orderId,payload.clientId,payload.contactName,payload.contactName,payload.contactPhone,payload.actionType,payload.branch,payload.address,itemsStr,'received',payload.createdAt,false,false,'webapp'];
  sh.appendRow(row);
  appendLog('createOrder',orderId);
  return {success:true,order:Object.assign({},payload,{orderId})};
}

function appendLog(action,ref){const ss=SpreadsheetApp.openById(SS_ID);let sh=ss.getSheetByName('logs');if(!sh) sh=ss.insertSheet('logs');if(sh.getLastRow()==0) sh.appendRow(['time','action','ref','user']);sh.appendRow([new Date(),action,ref,'webapp'])}
```

---

## sheets/ (CSV לדוגמה)

### clients.csv

```
clientId,username,password,name,phone,email,sites
C001,rami,demo123,ח. סבן,+972508860896,rami@saban.co.il,"אתר1: התלמיד 6;אתר2: החרש 10"
C002,yossi,pass456,יוסי הבנאי,0501234567,yossi@mail,"אתר1: הרחוב 12"
```

### products.csv

```
sku,name,category,unit,notes
P001,בטון יבש 25 ק"ג,חומרי בנין,שק,
P002,מכולת 8 ק"ב,מכולות,יח'
```

### colors.csv

```
brand,code,name
נירלט,NR-123,לבן שמנת
טמבור,TB-456,אפור בהיר
```

### orders\_template.csv

```
orderId,clientId,clientName,contactName,contactPhone,actionType,branch,address,items,status,createdAt,sentToWhatsapp,printed,lastUpdater
```

---

## DEPLOY.md (הוראות פריסה מפורטות)

```md
# פריסת ה-Web App והקצאת Google Sheets

1. צור Google Spreadsheet חדש בשם "hsaban-crm".
2. בתפריט File > Import, העלה את ה-CSV מהתיקייה sheets/ (או הדבק ידנית את הכותרות והדוגמאות).
3. פתח Extensions -> Apps Script.
4. צור פרויקט חדש והדבק את תוכן `Code.gs` שנמצא בתיקיית הפרויקט.
5. עדכן בשורה הראשונה של `Code.gs` את `SS_ID` עם מזהה ה-Spreadsheet (מאתר ה-URL בין `/d/` ל-`/edit`).
6. Deploy -> New deployment -> Select type = Web app.
   - תן שם, ולהרשאות בחר "Anyone" או "Anyone with link" (להתחלה בדמו).
   - קבל את ה-Web App URL.
7. פתח את `config.js` בקובץ ה-Front והחלף את `REPLACE_WITH_YOUR_WEBAPP_URL` ב-URL שקיבלת.
8. שמור את הקבצים ב-GitHub ותארח אותם כרצונך (GitHub Pages או שרת סטטי מקומי).
9. פתח את ה-index.html בדפדפן, בדוק כניסה עם הדמו credentials (rami/demo123), צור הזמנה, ובדוק שהשורות מתווספות בגליון 'orders'.

---

# בדיקות מהירות
- Login: rami / demo123
- Create order -> בדוק sheet orders
- Open wa.me link שנפתח ושלח ידנית (הדפסת הודעה נעשית דרך וואטסאפ בדפדפן/סלולרי)

```

---

## הערות וסיכום

* הוספתי את `WHATSAPP_DEPT` כערך קבוע ב-`config.js` (972508860896) כדי להבטיח שיתוף למחלקת הזמנות תמיד לכתובת זו.
* הקוד הוא דמו/יעיל להתחלה — מומלץ להוסיף אימות, הצפנת סיסמאות, CORS תקין ורמות הרשאה לפרודקשן.

אם תרצה, אני יכול כעת:

1. לפרט את הפקודות המדויקות ליצירת Git repo ולדחוף ל-GitHub (שלח לי את שם המשתמש והשם של הריפו או אבצע קובץ `git` להעתקה).
2. להכין ZIP להורדה של הקבצים (אני לא יכול לאכסן אותו ישירות ב-GitHub, אבל אוכל ליצור קובץ ZIP אם תבקש).
3. לפרוס עבורך את הקוד בתוך פרויקט Apps Script אם תיתן לי גישה (אין לי יכולת לגשת ישירות).

מה ברצונך שאעשה עכשיו? (למשל: הכין עבורך פקודות `git` כדי שתדביק בטרמינל ותדחוף ל-GitHub).
